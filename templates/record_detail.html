{% import "components/problem.html" as problem with context %}
{% extends "layout/basic.html" %}
{% block content %}
<script>
  var Context = {
    'socketUrl': "/record-detail-conn?rid={{ rdoc._id }}&token={{ handler.csrfToken }}"
  };
</script>
<div class="row">
  <div class="medium-9 columns">
    {% if showStatus %}
    {% include 'record_detail_STATUS.html' %}
    {% endif %}
    {% if rdoc['code'] %}
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('Code') }}</h1>
      </div>
      <div class="section__body" data-syntax-hl-show-line-number>
        <pre><code class="language-{{ model.builtin.LANG_HIGHLIGHT_ID[rdoc['lang']] }}">{{ rdoc['code'] }}</code></pre>
      </div>
    </div>
    {% endif %}
    {% if rdoc['stdout'] or rdoc['stderr'] %}
    <div class="section">
      <div class="section__header">
        <h1 class="section__title">{{ _('Stdout') }}</h1>
      </div>
      {% if rdoc['stdout'] %}
      <div class="section__body" data-syntax-hl-show-line-number>
        <pre><code>{{ rdoc['stdout']|ansi|safe }}</code></pre>
      </div>
      {% endif %}
      {% if rdoc['stderr'] %}
      <div class="section__body" data-syntax-hl-show-line-number>
        <pre><code>{{ rdoc['stderr']|ansi|safe }}</code></pre>
      </div>
      {% endif %}
    </div>
    {% endif %}
  </div>
  <div class="medium-3 columns">
    <div class="section side">
      <div class="section__header">
        <h1 class="section__title">{{ _('Information') }}</h1>
      </div>
    {% if handler.user.hasPerm(perm.PERM_REJUDGE) %}
      <div class="section__body no-padding">
        <ol class="menu">
          <li class="menu__item">
            <form method="post" action="{{ url('record_rejudge', rid=rdoc._id) }}">
              <input type="hidden" name="csrfToken" value="{{ handler.csrfToken }}">
              <button type="submit" class="menu__link">
                <span class="icon icon-refresh"></span> {{ _('Rejudge') }}
              </button>
            </form>
          </li>
          <li class="menu__item">
            <form method="post" action="{{ url('judge') }}">
              <input type="hidden" name="action" value="end">
              <input type="hidden" name="rid" value="{{ rdoc._id }}">
              <input type="hidden" name="csrfToken" value="{{ handler.csrfToken }}">
              <input type="hidden" name="score" value="0">
              <input type="hidden" name="message" value="{{ _('score canceled') }}">
              <button type="submit" class="menu__link">
                <span class="icon icon-close"></span> {{ _('Cancel Score') }}
              </button>
            </form>
          </li>
        </ol>
      </div>
    {% endif %}
      <div class="section__body typo">
        <dl class="large horizontal">
          <dt>{{ _('Submit By') }}</dt>
          <dd>{{ user.render_inline(udoc, modbadge=false) }}</dd>
        {% if pdoc %}
          <dt>{{ _('Problem') }}</dt>
          <dd>
            {{ problem.render_problem_title(pdoc, tdoc, show_tags=false, show_invisible_flag=false, rp=none) }}
          </dd>
        {% endif %}
        {% if tdoc %}
          <dt>{{ _('Contest') }}</dt>
          <dd>
            <a href="{{ url('contest_detail', tid=tdoc.docId) }}">{{ tdoc.title }}</a>
          </dd>
        {% endif %}
        {% if pdoc and (handler.user._id == pdoc.owner or handler.user.hasPerm(perm.PERM_READ_PROBLEM_DATA)) %}
          <dt>{{ _('Problem Data') }}</dt>
          <dd><a href="{{ url('problem_data', pid=pdoc.pid) }}"><span class="icon icon-download"></span> {{ _('Download') }}</a></dd>
        {% endif %}
          <dt>{{ _('Language') }}</dt>
          <dd>
            {{ model.builtin.LANG_TEXTS[rdoc['lang']] }}
          </dd>
          <dt>
            {{ _('Submit At') }}
          </dt>
          <dd>
            {{ datetimeSpan(rdoc._id)|safe }}
          </dd>
          {% if rdoc.judgeAt %}
          <dt>{{ _('Judged At') }}</dt>
          <dd>{{ datetimeSpan(rdoc.judgeAt)|safe }}</dd>
          {% endif %}
          {% if judge_udoc %}
          <dt>{{ _('Judged By') }}</dt>
          <dd>{{ user.render_inline(judge_udoc, badge=false) }}</dd>
          {% endif %}
        </dl>
        {% if show_status %}
        {% include 'record_detail_summary.html' %}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
